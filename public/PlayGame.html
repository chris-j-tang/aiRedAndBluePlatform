<!DOCTYPE html>

<html lang="en">

<head>
	<title>Red & Blue Game - Play Game</title>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="style/style.css">
	<link rel="stylesheet" href="style/vis.min.css">
	<script src="scripts/jquery-1.12.1.js"></script>
	<script src="scripts/vis.min.js"></script>
	
</head>

<body>
	<div id="scoreBar">
		<div id="redScore">	
			<p id="scoreBarText">Score</p>
			<p id="redScoreBarText">0</p>
		</div>
		
		<div id="blueScore">	
			<p id="scoreBarText">Score</p>
			<p id="blueScoreBarText">0</p>
		</div>
	
		<div id="yourGameSession">	
			<p id="scoreBarText">Time</p>
			<p id="timeTextValue">0</p>
		</div>
	</div>
	
	<div id="mynetwork"></div>
	
</body>

<script type="text/javascript">
var redScore = 0;
var blueScore = 0
var timeLimit = 5 * 1000;
var curTime = timeLimit;
var nodeCount = 50;
var nodes = null;
var turn = 0;

var noColor = {
	border: '#444444',
	background: '#CCCCCC',
	highlight:
	{
		border: '#111111',
		background: '#999999'
	}
};

var redColor = {
	color:
	{
		border: '#000000',
		background: '#FF0000'
	}
};

var blueColor = {
	color:
	{
		border: '#000000',
		background: '#FF0000'
	}
};

var updateTime;
var timer;
startTimer();

function startTimer() {
	clearInterval(updateTime);
	clearTimeout(timer);
	curTime = timeLimit;
	updateTime = setInterval(function() {
		setTime(curTime);
		curTime -= 100;
	},100);
	
	timer = setTimeout(function() {
		clearInterval(updateTime);
		setTime(curTime);
	}, timeLimit);
}

function setRedScore(score) {
	document.getElementById("redScoreBarText").innerHTML = score;
}

function setBlueScore(score) {
	document.getElementById("blueScoreBarText").innerHTML = score;
}

function setTime(time) {
	var timeStr = (time / 1000).toString();
	if(time % 1000 == 0) {
		timeStr += ".0";
	}
	document.getElementById("timeTextValue").innerHTML = timeStr;
}

var Node = function(id) {
	this.id =  id;
	this.label = id.toString();
	this.borderWidth = 2;
	this.borderWidthSelected = 3;
	this.color = noColor;
	this.font = {
		size: 24
	};
	this.team = 0;
}

nodes = createNodes(nodeCount);
var visNodes = new vis.DataSet(nodes);

function createNodes(num) {
	var nodes = [];
	for(var i = 1; i <= num; i++)
	{
		var n = new Node(i);
		nodes.push(n);
	}
	return nodes;
}

function createEdges(num, p) {
	var edges = [];
	for(var i = 1; i <= num; i++) {
		for(var k = 1; k <= num; k++) {
			if(i != k) {
				var rand = Math.random();
				if(rand < p) {
					var e = {from: i, to: k};
					edges.push(e);
				}
			}
		}
	}
	console.log(edges.length);
	return edges;
}

// create an array with edges
var visEdges = new vis.DataSet(createEdges(nodeCount, 0.03));

// create a network
var container = document.getElementById('mynetwork');

// provide the data in the vis format
var data = {
	nodes: visNodes,
	edges: visEdges
};

var options = {
	manipulation: false,
	interaction:
	{
		dragNodes: false,
		dragView: false
	},
	layout:
	{
		randomSeed: 0
	}
};
console.log(data);
// initialize your network!
var network = new vis.Network(container, data, options);

network.on("selectNode", function (params) {
	var selectedNodeId = params.nodes[0];
	var node = network.body.nodes[selectedNodeId];
	if(nodes[selectedNodeId - 1].team == 0)
	{
		if(turn == 1)
		{
			node.setOptions(
			  {
				color:
				  {
					border: '#000000',
					background: '#FF0000'
				  }
				});
			nodes[selectedNodeId - 1].team = 1;
			redScore++;
			for(var i = 0; i < params.edges.length; i++)
			{
				var edgeId = params.edges[i];
				var adjId = network.body.edges[edgeId].to.id != selectedNodeId ? network.body.edges[edgeId].to.id : network.body.edges[edgeId].from.id;
				var n = network.body.nodes[adjId];
				n.setOptions(
				  {
					color:
					  {
						border: '#000000',
						background: '#FF0000'
					  }
					});
					if(nodes[adjId - 1].team == 0)
					{
						redScore++;
					}
					else if(nodes[adjId - 1].team == 2)
					{
						blueScore--;
						redScore++;
					}
				nodes[adjId - 1].team = 1;
			}
			setRedScore(redScore);
			setBlueScore(blueScore);
			turn = 2;
		}
		else
		{
			node.setOptions(
			  {
				color:
				  {
					border: '#000000',
					background: '#0000FF'
				  }
				});
			nodes[selectedNodeId - 1].team = 2;
			blueScore++;
			for(var i = 0; i < params.edges.length; i++)
			{
				var edgeId = params.edges[i];
				var adjId = network.body.edges[edgeId].to.id != selectedNodeId ? network.body.edges[edgeId].to.id : network.body.edges[edgeId].from.id;
				var n = network.body.nodes[adjId];
				n.setOptions(
				  {
					color:
					  {
						border: '#000000',
						background: '#0000FF'
					  }
					});
					if(nodes[adjId - 1].team == 0)
					{
						blueScore++;
					}
					else if(nodes[adjId - 1].team == 1)
					{
						redScore--;
						blueScore++;
					}
				nodes[adjId - 1].team = 2;
			}
			setBlueScore(blueScore);
			setRedScore(redScore);
			turn = 1;
		}
		startTimer();
	}
	network.unselectAll();
});
  

document.getElementById("mynetwork").onclick = function (event)
{
	console.log(network.getSelectedNodes());
	//nodes[network.getSelectedNodes()[0] - 1].color.background = '#FF0000';
	//network = new vis.Network(container, data, options);
};

function setRound(round) {
	
}

subscribe: function(callback) {
	var longPoll = function() {
		$.ajax({
			method: 'GET', 
			success: function(data) {
				callback(data);
			},
			complete: function() {
				longPoll();
			},
			timeout: 30000
		});
	};
	longPoll();
}
</script>

<script type="text/javascript">
	window.onload = function() {
		var data = {
			playerName: sessionStorage.getItem("playerName"),
			sessionID: sessionStorage.getItem("sessionID"),
			host: sessionStorage.getItem("host"),
			socketID: "null"
		};
	};
</script>
</html>
